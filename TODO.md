# Cline for Cherry Studio 移植项目

> **项目目标**: 将 VSCode 插件 [Cline](https://github.com/HybridTalentComputing/cline-chinese) 的核心功能移植到桌面客户端 [Cherry Studio](https://github.com/CherryHQ/cherry-studio) 中。

> **核心原则**: 
> 1. **两阶段策略**: 先开发独立插件快速验证，再进行官方贡献。
> 2. **用户价值**: 无论哪个阶段，都以提供可用的功能为首要目标。
> 3. **代码质量**: 遵循 Cherry Studio 的代码规范和架构模式。
> 4. **透明度**: 每一步进展都记录在此文档中。

---

## 📅 两阶段项目时间线

| 阶段 | 里程碑 | 预计完成时间 | 主要目标 |
|---|---|---|---|
| **阶段一** | 独立插件 MVP | 第1-4周 | 开发可独立安装的 Cline 插件，快速验证技术方案 |
| **阶段二** | 官方贡献 | 第5周+ | 在插件成功基础上，向 Cherry Studio 官方仓库贡献代码 |

---

## 🚀 阶段一：独立插件开发

### 1.1. 开发环境准备
- [x] **任务**: 创建新的 GitHub 仓库 `cline-for-cherry-studio`。
  - **预期产出**: 一个包含基础项目结构的新仓库。
  - **验证方法**: 仓库创建成功，包含 README.md 和基本目录结构。
  - **文档更新**: 在 `## 1.1` 下记录仓库地址和初始化过程。
    - ✅ **2025-10-03 完成**: 成功创建 GitHub 仓库 https://github.com/Alan-88/cline-for-cherry-studio
    - ✅ 已初始化本地 Git 仓库并推送初始文件（TODO.md 和 start_prompt.md）
    - ✅ 仓库地址：https://github.com/Alan-88/cline-for-cherry-studio

- [x] **任务**: 深入研究 vscode-mcp-server 项目。
  - **预期产出**: 一份研究报告，包含关键代码片段和架构图。
  - **验证方法**: 能够解释清楚它的服务器是如何工作的，以及哪些部分可以借鉴。
  - **文档更新**: 在 `## 1.2` 下记录研究发现的可复用的模式和代码。
    - ✅ **2025-10-03 完成**: 完成 vscode-mcp-server 项目深度研究
    - ✅ 创建详细研究报告 `research-report-vscode-mcp-server.md`
    - ✅ 分析了核心架构：Express + MCP SDK + TypeScript
    - ✅ 识别了 5 大类工具：文件、编辑、诊断、符号、Shell
    - ✅ 提取了可复用的模式：服务器生命周期、工具配置、终端管理、日志系统
    - ✅ 确定了技术选型：Express.js + @modelcontextprotocol/sdk + React
    - ✅ 明确了适配需求：VSCode API → Cherry Studio API

- [x] **任务**: 设计我们的 MCP 服务器架构。
  - **预期产出**: 一份架构设计文档，包含技术选型和实现方案。
  - **验证方法**: 架构设计能够支持所有 Cline 的核心功能。
  - **文档更新**: 在 `## 1.3` 下记录架构决策和设计细节。
    - ✅ **2025-10-03 完成**: 完成 MCP 服务器架构设计
    - ✅ 创建详细架构设计文档 `mcp-architecture.md`
    - ✅ **技术栈确定**: Express.js + @modelcontextprotocol/sdk + TypeScript + React
    - ✅ **端口选择**: 3001 (避免与 vscode-mcp-server 的 3000 端口冲突)
    - ✅ **组件架构**: 插件入口 → MCP 服务器 → 工具层 → 系统层
    - ✅ **核心工具设计**: read_file, write_file, list_files, execute_command, create_directory
    - ✅ **安全策略**: 仅本地访问 (127.0.0.1), 工作目录限制, 命令确认机制
    - ✅ **项目结构**: 完整的 src/ 目录结构设计，包含 server/, ui/, types/, utils/
    - ✅ **配置系统**: 详细的 PluginConfig 接口设计，包含服务器、工具、UI、安全配置
    - ✅ **通信协议**: MCP JSON-RPC 2.0 协议规范
    - ✅ **性能优化**: 缓存、连接池、异步处理等优化策略
    - ✅ **错误处理**: 完整的错误处理和恢复机制
    - ✅ **测试策略**: 单元测试、集成测试、安全测试

### 1.2. 后端 MCP 服务器实现
- [x] **任务**: 在插件中集成一个轻量级的 MCP 服务器。
  - **预期产出**: 插件启动时，能够在本地（如 `localhost:3001`）启动一个 HTTP 服务器。
  - **验证方法**: 使用 Postman 或 curl 测试服务器响应。
  - **文档更新**: 在 `## 1.3` 下记录服务器技术选型和实现细节。
    - ✅ **2025-10-03 完成**: 成功集成轻量级 MCP 服务器
    - ✅ **技术实现**: Express.js + TypeScript + JSON-RPC 2.0
    - ✅ **服务器配置**: localhost:3001，支持 CORS、安全中间件
    - ✅ **核心端点**: 
      - `/health` - 健康检查
      - `/info` - 服务器信息
      - `/tools` - 工具列表
      - `/mcp` - JSON-RPC 2.0 主端点
    - ✅ **基础工具**: ping, echo, server_info
    - ✅ **测试验证**: 
      - 健康检查: `{"status":"healthy","timestamp":"2025-10-02T19:24:54.050Z","uptime":63470}`
      - 服务器信息: `{"name":"Cline for Cherry Studio MCP Server","version":"0.1.0","description":"MCP server providing Cline functionality for Cherry Studio","capabilities":["tools","file-operations","shell-commands","file-editing"]}`
      - 工具调用: 成功测试 ping 工具，返回正确的 JSON-RPC 2.0 响应
    - ✅ **日志系统**: 完整的请求日志和性能监控
    - ✅ **错误处理**: 统一的错误处理和优雅关闭
    - ✅ **TypeScript 编译**: 无错误，严格模式通过

- [ ] **任务**: 实现核心文件操作工具。
  - **预期产出**: 实现 `read_file`, `write_file`, `list_files` 等基础工具。
  - **验证方法**: 在插件界面中能够读取、写入和列出文件。
  - **文档更新**: 在 `## 1.4` 下记录各工具的实现和测试结果。

- [ ] **任务**: 实现命令执行工具。
  - **预期产出**: 实现 `execute_shell_command` 工具。
  - **验证方法**: 能够在插件中执行简单的 shell 命令并查看输出。
  - **文档更新**: 在 `## 1.5` 下记录实现细节和安全考虑。

### 1.3. 前端 UI 移植
- [ ] **任务**: 移植 Cline 的聊天界面到插件中。
  - **预期产出**: 一个功能完整的聊天界面，支持消息发送和显示。
  - **验证方法**: 能够在聊天界面中发送消息并看到响应。
  - **文档更新**: 在 `## 1.6` 下记录 UI 移植过程和适配细节。

- [ ] **任务**: 实现前后端通信。
  - **预期产出**: 前端能够调用后端工具，并正确显示结果。
  - **验证方法**: 在聊天中输入 "读取 README.md"，能够看到文件内容。
  - **文档更新**: 在 `## 1.7` 下记录通信协议和数据格式。

### 1.4. 插件打包与分发
- [ ] **任务**: 实现插件的打包机制。
  - **预期产出**: 一个可安装的插件包（如 .zip 文件）。
  - **验证方法**: 能够在干净的 Cherry Studio 环境中成功安装并使用插件。
  - **文档更新**: 在 `## 1.8` 下记录打包流程和文件结构。

- [ ] **任务**: 创建用户安装指南。
  - **预期产出**: 一份清晰的安装和使用文档。
  - **验证方法**: 按照指南，新用户能够成功安装和使用插件。
  - **文档更新**: 在 `## 1.9` 下附上安装指南链接。

### 1.5. MVP 发布与反馈收集
- [ ] **任务**: 发布插件 MVP 版本。
  - **预期产出**: 在 GitHub 上发布第一个可用的版本。
  - **验证方法**: 至少有 5 个用户成功安装并使用插件。
  - **文档更新**: 在 `## 1.10` 下记录发布过程和用户反馈。

---

## 🔧 阶段二：官方贡献

### 2.1. 准备工作
- [ ] **任务**: Fork `cherry-studio` 官方仓库。
  - **预期产出**: 个人账户下的 Fork 仓库。
  - **验证方法**: 能够在 GitHub 上看到 Fork 的仓库。
  - **文档更新**: 在 `## 2.1` 下记录 Fork 仓库地址。

- [ ] **任务**: 在社区中发起讨论。
  - **预期产出**: 在 Cherry Studio 的 Issues 或 Discussions 中获得社区的初步反馈。
  - **验证方法**: 至少有一位核心维护者对项目表示支持或兴趣。
  - **文档更新**: 在 `## 2.2` 下记录社区讨论的关键内容和反馈。

### 2.2. 代码重构与适配
- [ ] **任务**: 将插件代码重构为符合 Cherry Studio 规范的代码。
  - **预期产出**: 清理、优化后的代码，符合 Cherry Studio 的代码风格。
  - **验证方法**: 代码通过 Cherry Studio 的所有自动化检查。
  - **文档更新**: 在 `## 2.3` 下记录重构的主要改动。

- [ ] **任务**: 将功能集成到 Cherry Studio 主应用中。
  - **预期产出**: Cline 功能作为 Cherry Studio 的内置应用出现。
  - **验证方法**: 无需安装插件，直接在 Cherry Studio 中使用 Cline 功能。
  - **文档更新**: 在 `## 2.4` 下记录集成过程和修改的文件。

### 2.3. 官方贡献流程
- [ ] **任务**: 创建详细的 Pull Request。
  - **预期产出**: 一个信息完整、描述清晰的 PR。
  - **验证方法**: PR 通过所有自动化检查，并被社区审查。
  - **文档更新**: 在 `## 2.5` 下记录 PR 的链接和审查过程。

- [ ] **任务**: 响应反馈并完成合并。
  - **预期产出**: 代码被成功合并到官方仓库。
  - **验证方法**: PR 状态变为 "Merged"。
  - **文档更新**: 在 `## 2.6` 下记录从反馈到合并的完整过程。

---

## 📝 文档更新策略

**核心原则**: 每完成一个 `[ ]` 任务，都必须立即回到这个 `TODO.md` 文件，在对应的任务描述下更新进展。

- **如何更新**:
  1. 将 `[ ]` 改为 `[x]`。
  2. 在 `**文档更新**` 部分添加一行，简要说明你做了什么、学到了什么、或者遇到了什么问题。
  3. 如果有重要的代码片段或决策，也记录下来。

- **为什么重要**:
  - **可追踪性**: 任何人都可以清楚地看到项目进展和剩余工作。
  - **知识沉淀**: 你的思考和决策过程被记录下来，方便回顾和他人学习。
  - **风险控制**: 如果项目需要换人接手，详细的文档能保证平稳过渡。

---

## ⚠️ 风险评估与缓解策略

| 风险 | 阶段 | 可能性 | 影响程度 | 缓解策略 |
|---|---|---|---|---|
| **技术复杂性** | 阶段一 | 中 | 高 | 先做 MVP，快速验证核心功能。 |
| **插件分发困难** | 阶段一 | 中 | 中 | 提供多种安装方式，详细文档支持。 |
| **用户不接受** | 阶段一 | 中 | 中 | 早期收集反馈，快速迭代。 |
| **社区不接受** | 阶段二 | 低 | 高 | 阶段一成功后再启动阶段二，用数据说话。 |
| **代码重构困难** | 阶段二 | 中 | 中 | 阶段一时代码结构设计良好，降低重构难度。 |

---

## 🤝 如何参与本项目

欢迎任何形式的贡献！无论是代码、文档、测试还是想法，请通过以下方式参与：

1.  **查看此 TODO**: 了解当前进展和待办任务。
2.  **认领任务**: 在 Issue 中留言说你想要处理哪个任务。
3.  **开始工作**: Fork -> 创建分支 -> 开发 -> 提交 PR。
4.  **保持沟通**: 在 PR 或 Issue 中及时同步进展和问题。

---

## 📞 联系方式

如有任何问题或建议，请随时通过以下方式联系：

- **GitHub Issues**: [项目 Issues 页面]
- **Discord**: [社区频道链接]

---

*最后更新于: 2025-10-03*
